---
title: "R Notebook"
output: html_notebook
author: Rebecca Housey
date: 9 November 2020
---


Downloading csv file from ******
```{r}
library(dplyr)
library(rpart)
carData <- read.csv("/Users/rebeccahousey/Desktop/java/vehicles.csv", header = TRUE, sep = ',' ,na.strings = "", stringsAsFactors = FALSE)
#str(vehicles)

```
Cleaning data (1)
- removing 'cylinders' in cylinders column 
- removing id, url, region_url, county columns, image_url, description, vin (irrelevant)
- removing NAs 
- changing year to age of car

```{r} 
carData$cylinders <- gsub('cylinders', "", paste(carData$cylinders))
carData <- select(carData, -c(id, url, region_url, county, image_url, description, vin))
carData <- na.omit(carData)
carData[carData == 'NA'] <- NA
carData <- na.omit(carData)
carData %>% mutate(age = 2020-year) %>% select(-year) -> vehicles

```

Plotting to see correlations between price and other variables
1) There is a high correlation between price and transmission, 
```{r}
library(ggplot2)

ggplot(data = vehicles, aes(condition, price)) + geom_jitter(color = "blue", alpha = 0.5) + theme_light() + scale_y_log10()
 
ggplot(data = vehicles, aes(paint_color, price)) + geom_jitter(color = "blue", alpha = 0.05) + theme_light() + ylim(4000,100000)

vehicles %>% ggplot(aes(transmission, price))+geom_boxplot()+geom_jitter(alpha=0.05)+ ylim(4000,100000)


```
Splitting up the data 
Training and Testing Data to use 80% training 20% testing
```{r}
split <- sort(sample(nrow(carData), nrow(carData)*.8))
trainingCar <- carData[split,]
testCar <- carData[-split,]
```
Creating Models 
1) Decision Trees
2) MLR - Multiple Linear Regression
```{r}
tree_model<- rpart(price ~ region+year+manufacturer+model+condition+cylinders+fuel+odometer+title_status+transmission+drive+size+type+paint_color+state+lat+long, data = carData, method = "class")

t <- table(data.frame(carData$Price, pred =predict(tree_model, type = "class")))
t
tree_accuracy <- sum(diag(t))/sum(t)


#ADD IN MULTIPLE LINEAR REGRESSION HERE(MLR)



summary(carRegression)
sapply(vehicles, function(x) sum(is.na(x)))
pred_value <- predict(carRegression, testCar)

real_preds <- data.frame(cbind(actuals=test$births, predicteds=pred.value))  
corr_accur <- cor(real_preds$actuals, real_preds$predicteds)  
corr_accur 

#getting mean square error
mape <- mean(abs((real_preds$predicteds - real_preds$actuals))/real_preds$actuals)
mse <- mean((testCar$price-pred_value)^2)
mse
```



```{r}

```





